probs <- predict(glm1, newdata=test, type="response")
dim(probs)
probs
probs <- predict(glm1, data=test, type="response")
probs
probs <- predict(glm1, test, type="response")
probs
if (!require(HSAUR)){
install.packages("HSAUR")
}
library("HSAUR")
data(plasma)
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
summary(glm1)
if (!require(HSAUR)){
install.packages("HSAUR")
}
library("HSAUR")
str(plasma)
head(plasma)
par(mfrow=c(1,2))
plot(plasma$ESR, plasma$fibrinogen, main="Fibrinogen", ylab="", varwidth=TRUE)
plot(plasma$ESR, plasma$globulin, main="Globulin", ylab="", varwidth=TRUE)
par(mfrow=c(1,2))
cdplot(plasma$ESR~plasma$fibrinogen)
cdplot(plasma$ESR~plasma$globulin)
set.seed(3)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
summary(glm1)
probs
glm1 <- glm(plasma$ESR~plasma$fibrinogen, data=train, family=binomial)
summary(glm1)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs>0.5, 2, 1)
acc1 <- mean(pred==as.integer(test$ESR))
print(paste("glm1 accuracy = ", acc1))
table(pred, as.integer(test$ESR))
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
summary(glm1)
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
table(pred, as.integer(test$ESR))
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
table(pred, as.integer(test$ESR))
set.seed(3)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
table(pred, as.integer(test$ESR))
glm1 <- glm(plasma$ESR~plasma$fibrinogen, data=train, family=binomial)
summary(glm1)
if (!require(HSAUR)){
install.packages("HSAUR")
}
library("HSAUR")
str(plasma)
head(plasma)
par(mfrow=c(1,2))
plot(plasma$ESR, plasma$fibrinogen, main="Fibrinogen", ylab="", varwidth=TRUE)
plot(plasma$ESR, plasma$globulin, main="Globulin", ylab="", varwidth=TRUE)
par(mfrow=c(1,2))
cdplot(plasma$ESR~plasma$fibrinogen)
cdplot(plasma$ESR~plasma$globulin)
set.seed(3)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
summary(glm1)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
table(pred, as.integer(test$ESR))
fibro <- glm1$coefficients[2]
intercept <- glm1$coefficients[1]
log_odds <- function(x, fibro, intercept){
intercept + fibro * x
}
x <- seq(from=2.25, to=5.0, by=0.25)
y <- log_odds(x, fibro, intercept)
par(mfrow=c(1,2))
plot(x,y, main="log odds", ylab="")
prob <- exp(y) / (1 + exp(y))
plot(x, prob, main="probabilities", ylab="")
glm2 <- glm(ESR~fibrinogen+globulin, data=train, family=binomial)
summary(glm2)
probs <- predict(glm1, newdata=test, type="response")
pred <- ifelse(probs>0.5, 2, 1)
acc2 <- mean(pred==as.integer(test$ESR))
print(paste("glm2 accuracy = ", acc2))
table(pred, as.integer(test$ESR))
anova(glm1, glm2)
set.seed(1234)
i <- sample(1:nrow(plasma), 0.75*nrow(plasma), replace=FALSE)
train <- plasma[i,]
test <- plasma[-i,]
glm1 <- glm(ESR~fibrinogen, data=train, family=binomial)
summary(glm1)
probs <- predict(glm1,  newdata=test, type="response")
pred <- ifelse(probs> 0.5, 2, 1)
acc <- mean(pred == as.integer(test$ESR))
table(pred, as.integer(test$ESR))
fibro <- glm1$coefficients[2]
intercept <- glm1$coefficients[1]
log_odds <- function(x, fibro, intercept){
intercept + fibro * x
}
x <- seq(from=2.25, to=5.0, by=0.25)
y <- log_odds(x, fibro, intercept)
par(mfrow=c(1,2))
plot(x,y, main="log odds", ylab="")
prob <- exp(y) / (1 + exp(y))
plot(x, prob, main="probabilities", ylab="")
glm2 <- glm(ESR~fibrinogen+globulin, data=train, family=binomial)
summary(glm2)
probs <- predict(glm1, newdata=test, type="response")
pred <- ifelse(probs>0.5, 2, 1)
acc2 <- mean(pred==as.integer(test$ESR))
print(paste("glm2 accuracy = ", acc2))
table(pred, as.integer(test$ESR))
anova(glm1, glm2)
if (!require(caret)){
install.packages("caret")
}
library("caret")
if (!require(mlbench)){
install.packages("mlbench")
}
library("mlbench")
if (!require(caret)){
install.packages("FSelector")
}
library("FSelector")
if (!require(caret)){
install.packages("caret")
}
library("caret")
if (!require(mlbench)){
install.packages("mlbench")
}
library("mlbench")
if (!require(Fselector)){
install.packages("FSelector")
}
library("FSelector")
install.packages("randomForest")
if (!require(caret)){
install.packages("caret")
}
library("caret")
if (!require(mlbench)){
install.packages("mlbench")
}
library("mlbench")
if (!require(Fselector)){
install.packages("FSelector")
}
library("FSelector")
library(randomForest)
install.packages("randomForest")
rfNews()
install.packages("randomForest")
install.packages("FSelector")
libary(FSelector)
library(FSelector)
install.packages(rJava)
install.packages("rJava")
library(FSelector)
if (!require(caret)){
install.packages("caret")
}
library("caret")
if (!require(mlbench)){
install.packages("mlbench")
}
library("mlbench")
if (!require(Fselector)){
install.packages("FSelector")
}
library("FSelector")
if (!require(caret)){
install.packages("caret")
}
library("caret")
if (!require(mlbench)){
install.packages("mlbench")
}
library("mlbench")
#if (!require(Fselector)){
#  install.packages("FSelector")
#}
#library("FSelector")
library(caret)
library(mlbench)
data("PimaIndiansDiabetes2")
df <- PimaIndiansDiabetes2[complete.cases(PimaIndiansDiabetes2[]),]
corMatrix <- cor(df[,1:7])
findCorrelation(corMatrix, cutoff=0.5, verbose=TRUE)
df <- df[,-c(2,6)]
ctrl <- trainControl(method="repeatedcv", repeats=5)
model <- train(diabetes~., data=df, method="knn", preProcess="scale", trControl=ctrl)
importance <- varImp(model, scale=FALSE)
importance
plot(importance)
df <- PimaIndiansDiabetes2[complete.cases(PimaIndiansDiabetes2[]),]
ctrl <- rfeControl(functions=rfFuncs, method="cv", number=10)
rfe_out <- rfe(df[,1:7], df[,8], sizes=c(1:7), rfeControl=ctrl)
rfe_out
df <- read.csv("data/titanic.csv", header=TRUE)
# data cleaning
df <- df[,c(1,2,4,5)]
df$pclass <- factor(df$pclass)
df$survived <- factor(df$survived)
# handle missing values
df$age[is.na(df$age)] <- median(df$age,na.rm=T)
set.seed(1234)
i <- sample(1:nrow(df), 0.75*nrow(df), replace=FALSE)
train <- df[i,]
test <- df[-i,]
if (!require(e1071)){
install.packages("e1071")
}
library("e1071")
df <- read.csv("data/titanic.csv", header=TRUE)
# data cleaning
df <- df[,c(1,2,4,5)]
df$pclass <- factor(df$pclass)
df$survived <- factor(df$survived)
# handle missing values
df$age[is.na(df$age)] <- median(df$age,na.rm=T)
set.seed(1234)
i <- sample(1:nrow(df), 0.75*nrow(df), replace=FALSE)
train <- df[i,]
test <- df[-i,]
library(e1071)
nb1 <- naiveBayes(survived~., data=train)
nb1
p1 <- predict(nb1, newdata=test, type="class")
table(p1, test$survived)
mean(p1==test$survived)
p1_raw <- predict(nb1, newdata=test, type="raw")
head(p1_raw)
nb2 <- naiveBayes(survived~.-age, data=train)
p2 <- predict(nb2, newdata=test[,-4], type="class")
table(p2, test$survived)
mean(p2==test$survived)
if (!require(e1071)){
install.packages("e1071")
}
library("e1071")
df <- read.csv("data/titanic3.csv", header=TRUE, stringsAsFactors = FALSE)
# subset to just columns survived, pclass, sex, and age
df <- df[,c(1,2,4,5)]
# pclass and survived  and sex should be factors
df$pclass <- factor(df$pclass)
df$survived <- factor(df$survived)
df$sex <- factor(df$sex, levels=c("female", "male"))
# remove NAs
df <- df[!is.na(df$pclass),]
df <- df[!is.na(df$survived),]
df$age[is.na(df$age)] <- median(df$age,na.rm=T)
# divide into train and test
set.seed(1234)
i <- sample(1:nrow(df), 0.75*nrow(df), replace=FALSE)
train <- df[i,]
test <- df[-i,]
# perform Naive Bayes
library(e1071)
nb1 <- naiveBayes(df[,-2], df[,2], data=train)
pred <- predict(nb1, newdata=test[,-2], type="raw")
# look at first 5 (actual: 0 1 1 1 0)
pred[1:5,]
apriori <- c(
nrow(df[df$survived=="0",])/nrow(df),
nrow(df[df$survived=="1",])/nrow(df)
)
print("Prior probability, survived=no, survived=yes:")
apriori
if (!require(e1071)){
install.packages("e1071")
}
library("e1071")
df <- read.csv("data/titanic3.csv", header=TRUE, stringsAsFactors = FALSE)
# subset to just columns survived, pclass, sex, and age
df <- df[,c(1,2,4,5)]
# pclass and survived  and sex should be factors
df$pclass <- factor(df$pclass)
df$survived <- factor(df$survived)
df$sex <- factor(df$sex, levels=c("female", "male"))
# remove NAs
df <- df[!is.na(df$pclass),]
df <- df[!is.na(df$survived),]
df$age[is.na(df$age)] <- median(df$age,na.rm=T)
# divide into train and test
set.seed(1234)
i <- sample(1:nrow(df), 0.75*nrow(df), replace=FALSE)
train <- df[i,]
test <- df[-i,]
# perform Naive Bayes
library(e1071)
nb1 <- naiveBayes(df[,-2], df[,2], data=train)
pred <- predict(nb1, newdata=test[,-2], type="raw")
# look at first 5 (actual: 0 1 1 1 0)
pred[1:5,]
apriori <- c(
nrow(df[df$survived=="0",])/nrow(df),
nrow(df[df$survived=="1",])/nrow(df)
)
print("Prior probability, survived=no, survived=yes:")
apriori
# get survived counts for no and yes
count_survived <- c(
length(df$survived[df$survived=="0"]),
length(df$survived[df$survived=="1"])
)
# likelihood for pclass
lh_pclass <- matrix(rep(0,6), ncol=3)
for (sv in c("0", "1")){
for (pc in c("1","2","3")) {
lh_pclass[as.integer(sv)+1, as.integer(pc)] <-
nrow(df[df$pclass==pc & df$survived==sv,]) / count_survived[as.integer(sv)+1]
}
}
# likelihood for sex
lh_sex <- matrix(rep(0,4), ncol=2)
for (sv in c("0", "1")){
for (sx in c(1, 2)) {
lh_sex[as.integer(sv)+1, sx] <-
nrow(df[as.integer(df$sex)==sx & df$survived==sv,]) /
count_survived[as.integer(sv)+1]
}
}
print("Likelihood values for p(pclass|survived):")
lh_pclass
print("Likelihood values for p(sex|survived):")
lh_sex
age_mean <- c(0, 0)
age_var <- c(0, 0)
for (sv in c("0", "1")){
age_mean[as.integer(sv)+1] <-
mean(df$age[df$survived==sv])
age_var[as.integer(sv)+1] <-
var(df$age[df$survived==sv])
}
calc_age_lh <- function(v, mean_v, var_v){
# run like this: calc_age_lh(6, 25.9, 138)
1 / sqrt(2 * pi * var_v) * exp(-((v-mean_v)^2)/(2 * var_v))
}
calc_raw_prob <- function(pclass, sex, age) {
# pclass=1,2,3  sex=1,2   age=numeric
num_s <- lh_pclass[2, pclass] * lh_sex[2, sex] * apriori[2] *
calc_age_lh(age, age_mean[2], age_var[2])
num_p <- lh_pclass[1, pclass] * lh_sex[1, sex] * apriori[1] *
calc_age_lh(age, age_mean[1], age_var[1])
denominator <- lh_pclass[2, pclass]  * lh_sex[2, sex] * calc_age_lh(age, age_mean[2], age_var[2]) * apriori[2] +
lh_pclass[1, pclass]  * lh_sex[1, sex] * calc_age_lh(age, age_mean[1], age_var[1]) * apriori[1]
return (list(prob_survived <- num_s / denominator, prob_perished <- num_p / denominator))
}
for (i in 1:5){
raw <- calc_raw_prob(test[i,1], as.integer(test[i,3]), test[i,4])
print(paste(raw[2], raw[1]))
}
pred[1:5,]
str(iris)    # display the structure of the object
summary(iris)
plot(Petal.Length, Petal.Width, pch=21, bg=c("red","green3","blue")
[unclass(Species)], main="Iris Data")
plot(iris$Petal.Length, iris$PPetal.Width, pch=21, bg=c("red","green3","blue")
[unclass(iris$PSpecies)], main="Iris Data")
plot(iris$Petal.Length, iris$PPetal.Width, pch=21, bg=c("red","green3","blue")
[unclass(iris$PSpecies)], main="Iris Data")
pairs(iris[1:4], main = "Iris Data", pch = 21, bg = c("red", "green3", "blue")[unclass(iris$PSpecies)])
plot(iris$Petal.Length, iris$Petal.Width, pch=21, bg=c("red","green3","blue")
[unclass(iris$Species)], main="Iris Data")
pairs(iris[1:4], main = "Iris Data", pch = 21, bg = c("red", "green3", "blue")[unclass(iris$Species)])
set.seed(1958)  # setting a seed gets the same results every time
ind <- sample(2, nrow(iris), replace=TRUE, prob=c(0.67, 0.33))
iris.train <- iris[ind==1, 1:4]
iris.test <- iris[ind==2, 1:4]
iris.trainLabels <- iris[ind==1, 5]
iris.testLabels <- iris[ind==2, 5]
library(class)
iris_pred <- knn(train=iris.train, test=iris.test, cl=iris.trainLabels, k=3)
if (!require(class)){
install.packages("class")
}
library("class")
iris_pred <- knn(train=iris.train, test=iris.test, cl=iris.trainLabels, k=3)
results <- iris_pred == iris.testLabels
acc <- length(which(results==TRUE)) / length(results)
# or combine into one line:
#acc <- length(which(iris_pred == iris.testLabels)) / length(iris_pred)
table(results, iris_pred)
acc
?iris
if (!require(ISLR)){
install.packages("ISLR")
}
library("ISLR")
if (!require(ISLR)){
install.packages("ISLR")
}
library("ISLR")
set.seed(1234)
i <- sample(1:nrow(Auto), round(nrow(Auto)*0.8), replace=FALSE)
train <- Auto[i, -9]
test <- Auto[-i, -9]
lm1 <- lm(mpg ~., data=train)
summary(lm1)
pred1 <- predict(lm1, newdata=test)
cor_lm1 <- cor(pred1, test$mpg)
mse_lm1 <- mean((pred1 - test$mpg)^2)
print(paste("cor=", cor_lm1))
print(paste("mse=", mse_lm1))
library(caret)
train$origin <- as.integer(train$origin)
test$origin <- as.integer(test$origin)
# fit the model
fit <- knnreg(train[,2:8],train[,1],k=3)
# evaluate
pred2 <- predict(fit, test[,2:8])
cor_knn1 <- cor(pred2, test$mpg)
mse_knn1 <- mean((pred2 - test$mpg)^2)
print(paste("cor=", cor_knn1))
print(paste("mse=", mse_knn1))
train_scaled <- train[, 2:8]  # omit name and don't scale mpg
means <- sapply(train_scaled, mean)
stdvs <- sapply(train_scaled, sd)
train_scaled <- scale(train_scaled, center=means, scale=stdvs)
test_scaled <- scale(test[, 2:8], center=means, scale=stdvs)
fit <- knnreg(train_scaled, train$mpg, k=3)
pred3 <- predict(fit, test_scaled)
cor_knn2 <- cor(pred3, test$mpg)
mse_knn2 <- mean((pred3 - test$mpg)^2)
print(paste("cor=", cor_knn2))
print(paste("mse=", mse_knn2))
print(paste("rmse=", sqrt(mse_knn2)))
cor_k <- rep(0, 20)
mse_k <- rep(0, 20)
i <- 1
for (k in seq(1, 39, 2)){
fit_k <- knnreg(train_scaled,train$mpg, k=k)
pred_k <- predict(fit_k, test_scaled)
cor_k[i] <- cor(pred_k, test$mpg)
mse_k[i] <- mean((pred_k - test$mpg)^2)
print(paste("k=", k, cor_k[i], mse_k[i]))
i <- i + 1
}
plot(1:20, cor_k, lwd=2, col='red', ylab="", yaxt='n')
par(new=TRUE)
plot(1:20, mse_k, lwd=2, col='blue', labels=FALSE, ylab="", yaxt='n')
which.min(mse_k)
which.max(cor_k)
fit <- knnreg(train_scaled, train$mpg, k=1)
pred4 <- predict(fit, test_scaled)
cor_knn3 <- cor(pred4, test$mpg)
mse_knn3 <- mean((pred4 - test$mpg)^2)
print(paste("cor=", cor_knn3))
print(paste("mse=", mse_knn3))
Auto$origin <- as.factor(Auto$origin)
str(Auto)
if (!require(ISLR)){
install.packages("ISLR")
}
library("ISLR")
if (!require(caret)){
install.packages("caret")
}
library("caret")
# uses the caret library
set.seed(1234)
folds <- createFolds(df$mpg, k=10)
